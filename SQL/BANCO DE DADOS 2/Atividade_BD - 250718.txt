--drop table AUDITORIA;
--drop table CLIENTE;
--drop table CLIENTE;
--drop table CURSO;
--drop table CURSO_AUDIT;
--drop table ESTUDANTE;
--drop table FATURA;
--drop table FITA;
--drop table FONEPESSOA;
--drop table GENERO;
--drop table ITEM_NOTA;
--drop table NOTA_FISCAL;
--drop table PESSOA;
--drop table PRECO;
--drop table PRODUTO;
--drop table REPUBLICA;




Create table genero (
Cod_genero varchar2(02) not null,
Nom_genero varchar2(15) not null);
Alter table genero add constraint pk_genero primary key (cod_genero);

Create table fita (
Cod_fita number(6) not null,
Cod_genero varchar2(02) not null,
Tit_fita varchar2(50) not null,
Qtd_fita number(2) not null,
Cod_preco varchar2(1) not null);

Alter table fita add constraint pk_fita primary key (cod_fita);

Create table preco (
Cod_preco varchar2(1) not null,
Des_preco varchar2(20) not null,
Val_preco number(5,2) not null);

Alter table preco add constraint pk_preco primary key (cod_preco);

Alter Table Fita Add Constraint fk_genero Foreign Key (COD_GENERO)
References GENERO(cod_genero);

Alter Table Fita Add Constraint fk_preco Foreign Key (COD_PRECO)
References PRECO(cod_preco);

Create table cliente (
 Cod_cliente number(5) not null,
 nom_cliente varchar2(30) not null,
 num_telefone varchar2(10) not null);

Alter table cliente add constraint pk_cli primary key (cod_cliente);

Create table locacao (
 num_locacao number(5) not null,
 dat_locacao date not null,
 cod_cliente number(5) not null);

Alter table locacao add constraint pk_loc primary key (num_locacao);

Alter Table locacao Add Constraint fk_cliente Foreign Key (cod_cliente)
References CLIENTE(cod_cliente);

Create table itens_locacao (
 num_locacao number(5) not null,
 num_item number(2) not null,
 cod_fita number(6) not null,
 dat_prevista_devolucao date not null,
 dat_devolucao date);

Alter table itens_locacao add constraint pk_itens primary key
(num_locacao,num_item);

Alter Table itens_locacao Add Constraint fk_locacao Foreign Key
(num_locacao) References locacao(num_locacao);

Alter Table itens_locacao Add Constraint fk_fita Foreign Key (cod_fita)
References fita(cod_fita);

INSERT INTO CLIENTE VALUES (1, 'ERIC', 4332322558);
INSERT INTO CLIENTE VALUES (2, 'EricMaycon', 498791984);
INSERT INTO CLIENTE VALUES (3, 'Rian', 181668798);
INSERT INTO CLIENTE VALUES (4, 'Tompson', 1484535789);
INSERT INTO CLIENTE VALUES (5, 'CIRE', 9874984845);
INSERT INTO CLIENTE VALUES (6, 'Maycon', 989451168);


INSERT INTO GENERO VALUES (1, 'Ação');
INSERT INTO GENERO VALUES (2, 'Terror');
INSERT INTO GENERO VALUES (3, 'Leite');
INSERT INTO GENERO VALUES (4, 'Pão');
INSERT INTO GENERO VALUES (5, 'Comedia');



INSERT INTO PRECO VALUES (1, 12.5, 55.9);
INSERT INTO PRECO VALUES (2, 1.5, 25.5);
INSERT INTO PRECO VALUES (3, 6.5, 15.9);
INSERT INTO PRECO VALUES (4, 13.9, 65.7);
INSERT INTO PRECO VALUES (5, 20.3, 78.9);
INSERT INTO PRECO VALUES (6, 9.9, 31.5);


INSERT INTO LOCACAO VALUES (1, sysdate, 2);
INSERT INTO LOCACAO VALUES (2, sysdate - 1, 4);
INSERT INTO LOCACAO VALUES (3, sysdate - 7, 1);
INSERT INTO LOCACAO VALUES (4, sysdate - 21, 6);
INSERT INTO LOCACAO VALUES (5, sysdate - 30, 2);


INSERT INTO FITA VALUES (1, 1, 'STAR WARS 1', 3, 5);
INSERT INTO FITA VALUES (2, 4, 'MIRANHA 2', 2, 4);
INSERT INTO FITA VALUES (3, 3, 'O SENHOR DOS ANÉIS 1', 15, 1);
INSERT INTO FITA VALUES (4, 3, 'Douglas, O encara raios', 21, 2);
INSERT INTO FITA VALUES (5, 2, 'Um filme de um filme', 99, 6);
INSERT INTO FITA VALUES (6, 5, 'Jankempo', 15, 3);

select * from FITA;

INSERT INTO ITENS_LOCACAO VALUES(1, 7, 4, sysdate + 30, sysdate + 15);
INSERT INTO ITENS_LOCACAO VALUES(3, 8, 2, sysdate + 15, sysdate + 4);
INSERT INTO ITENS_LOCACAO VALUES(5, 9, 5, sysdate + 7, sysdate + 9);
INSERT INTO ITENS_LOCACAO VALUES (1, 1, 1, sysdate + 1, sysdate + 3);
INSERT INTO ITENS_LOCACAO VALUES (5, 2, 3, sysdate + 1, sysdate + 6);
INSERT INTO ITENS_LOCACAO VALUES (4, 3, 2, sysdate, sysdate + 7);

INSERT INTO ITENS_LOCACAO VALUES (4, 10, 3, sysdate + 4, sysdate + 6);
INSERT INTO ITENS_LOCACAO VALUES (2, 11, 3, sysdate + 3, sysdate + 5);
INSERT INTO ITENS_LOCACAO VALUES (3, 12, 1, sysdate, sysdate + 1);

INSERT INTO ITENS_LOCACAO VALUES(4,4,4, sysdate + 1, sysdate + 3);
INSERT INTO ITENS_LOCACAO VALUES(2,5,2, sysdate + 1, sysdate + 9);
INSERT INTO ITENS_LOCACAO VALUES(1,6,1, sysdate + 1, sysdate);


-- PDF DE CRAÇÃO DE TABELAS:

-- Questão 01:

select CL.NOM_CLIENTE, LO.LOCACAO
from CLIENTE CL join LOCACAO LO
on CL.COD_CLIENTE = LO.COD_CLIENTE
order by CL.NOM_CLIENTE;

-- Questão 02:

select CL.NOM_CLIENTE, L.DAT_LOCACAO
from CLIENTE CL join LOCACAO L 
on CL.COD_CLIENTE = L.COD_CLIENTE;

-- Questão 03:

select F.Tit_fita, count(I.NUM_LOCACAO)
from FITA F join ITENS_LOCACAO I
on F.COD_FITA = I.COD_FITA
group by F.Tit_fita
having count(I.NUM_LOCACAO) > 10;

-- Questão 04:

select F.Tit_fita, I.dat_prevista_devolucao, COUNT(I.dat_devolucao)
from FITA F join ITENS_LOCACAO I
on F.COD_FITA = I.COD_FITA
where I.DAT_PREVISTA_DEVOLUCAO - I.DAT_DEVOLUCAO >= 2;



-- PDF DO VIEWS:

-- Questão 01:

CREATE VIEW vw_locados_cliente
select C.COD_CLIENTE, C.NOM_CLIENTE, C.NUM_TELELEFONE, G.NOM_GENERO, count(I.NUM_LOCACAO) 
from CLIENTE C join LOCACAO L
on C.COD_CLIENTE = L.COD_CLIENTE
join ITENS_LOCACAO I
on I.NUM_LOCACAO = L.NUM_LOCACAO
join FITA F 
on F.COD_FITA = I.COD_FITA
join GENERO G on G.COD_GENERO = F.COD_GENERO
GROUP BY C.COD_CLIENTE, C.NOM_CLIENTE, C.NUM_TELEFONE, G.NOM_GENERO;
 

-- Questão 02:

desc vw_locados_cliente;

-- Questão 03:

select * from vw_locados_cliente
where "Gênero" = 'Aventura' and "Quantidade de locações" > 70;

-- Questão 04:

CREATE VIEW vw_fita_sem_locacao
select F.COD_FITA, F.TIT_FITA, G.NOM_GENERO     
from FITA F left join ITENS_LOCACAO I 
on I.COD_FITA = F.COD_FITA
left join GENERO G 
on G.COD_GENERO = F.COD_GENERO
where F.COD_FITA not in (select LL.COD_FITA from ITENS_LOCACAO LL where LL.COD_FITA = F.COD_FITA);
 
-- Questão 05:

select * from vw_fita_sem_locacao
order by "Título da Fita";