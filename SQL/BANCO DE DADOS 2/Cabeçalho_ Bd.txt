Cabeçalho:
Bd 250718

Nota:
-- Exercício 03
SELECT f.TIT_FITA AS Título, COUNT(il.NUM_LOCACAO) AS Quantidade
FROM FITA f JOIN ITENS_LOCACAO il ON f.COD_FITA = il.COD_FITA
      GROUP BY f.TIT_FITA
      HAVING COUNT(il.NUM_LOCACAO) > 10;

-- Exercício 04
SELECT f.TIT_FITA AS Título, 
       il.DAT_PREVISTA_DEVOLUCAO AS "Data prevista de devolução",
       il.DAT_DEVOLUCAO AS "Data devolução"
FROM FITA f JOIN ITENS_LOCACAO il ON f.COD_FITA = il.COD_FITA
       WHERE il.DAT_DEVOLUCAO > il.DAT_PREVISTA_DEVOLUCAO + 2;     
	   
-- =================================================== EXERCÍCIOS VIWS ===================================================
	   
-- Exercício 01
CREATE VIEW vw_locados_cliente AS
SELECT c.COD_CLIENTE    AS "Código do Cliente",
       c.NOM_CLIENTE    AS "Nome do Cliente",
       c.NUM_TELEFONE   AS "Telefone",
       g.NOM_GENERO     AS "Gênero",
       COUNT(il.NUM_LOCACAO) AS "Quantidade de locações"
FROM CLIENTE c
       JOIN LOCACAO l ON c.COD_CLIENTE = l.COD_CLIENTE
       JOIN ITENS_LOCACAO il ON il.NUM_LOCACAO = l.NUM_LOCACAO
       JOIN FITA f ON f.COD_FITA = il.COD_FITA
       JOIN GENERO g ON g.COD_GENERO = f.COD_GENERO
GROUP BY c.COD_CLIENTE, c.NOM_CLIENTE, c.NUM_TELEFONE, g.NOM_GENERO;

-- Exercício 02
DESC vw_locados_cliente;

-- Exercício 03
SELECT * FROM vw_locados_cliente
WHERE "Gênero" = 'Aventura'
AND "Quantidade de locações" > 70;

-- Exercício 04
CREATE VIEW vw_fita_sem_locacao AS
SELECT f.COD_FITA       AS "Código da Fita",
       f.TIT_FITA       AS "Título da Fita",
       g.NOM_GENERO     AS "Gênero"
FROM FITA f
       LEFT JOIN ITENS_LOCACAO il ON il.COD_FITA = f.COD_FITA
       LEFT JOIN GENERO g ON g.COD_GENERO = f.COD_GENERO
WHERE f.COD_FITA NOT IN (SELECT ll.COD_FITA 
                     FROM ITENS_LOCACAO ll
                     WHERE ll.COD_FITA = f.COD_FITA);

-- Exercício 05
SELECT * FROM vw_fita_sem_locacao
ORDER BY "Título da Fita";